<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Website Builder</title>
    <script src="https://unpkg.com/@grapesjs/studio-sdk/dist/index.umd.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/@grapesjs/studio-sdk/dist/style.css" />

    <style>
      /* 1. LAYOUT: The main container that holds AI + Editor */
      body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background: #111; font-family: sans-serif; }
      
      .main-layout {
        display: flex;
        height: 100vh;
        width: 100vw;
      }

      /* 2. LEFT PANE: Your Custom AI Chatbot */
      .ai-pane {
        width: 350px; /* Fixed width for the sidebar */
        background: #1e1e1e;
        border-right: 1px solid #333;
        display: flex;
        flex-direction: column;
        color: #ddd;
        z-index: 10; /* Ensure it stays on top */
      }

      .ai-header {
        padding: 15px;
        background: #252525;
        border-bottom: 1px solid #333;
        font-weight: bold;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .ai-chat-area {
        flex: 1;
        overflow-y: auto;
        padding: 15px;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .ai-input-area {
        padding: 15px;
        background: #252525;
        border-top: 1px solid #333;
        display: flex;
        gap: 8px;
      }

      /* 3. RIGHT PANE: The Embedded GrapesJS Editor */
      .editor-container {
        flex: 1; /* Takes up all remaining space */
        position: relative;
      }

      /* Styling the Chat Components */
      .message { padding: 10px; border-radius: 6px; font-size: 0.9rem; line-height: 1.4; max-width: 90%; }
      .message.bot { background: #333; align-self: flex-start; border: 1px solid #444; }
      .message.user { background: #6200ea; color: white; align-self: flex-end; }
      
      input.ai-input {
        flex: 1; padding: 10px; border-radius: 4px; border: 1px solid #444; background: #111; color: white;
      }
      button.ai-btn {
        padding: 0 20px; border-radius: 4px; border: none; background: #6200ea; color: white; font-weight: bold; cursor: pointer;
      }
      button.ai-btn:hover { background: #7c4dff; }
      
      /* Status indicator */
      .status-dot { width: 8px; height: 8px; background: #00e676; border-radius: 50%; }
    </style>
  </head>
  <body>

    <div class="main-layout">
      <div class="ai-pane">
        <div class="ai-header">
          <div class="status-dot"></div>
          AI Designer
        </div>
        
        <div class="ai-chat-area" id="chat-history">
          <div class="message bot">
            Hello! I'm connected to the editor. Describe what you want, and I will build it.
          </div>
        </div>

        <div class="ai-input-area">
          <input type="text" class="ai-input" id="user-input" placeholder="e.g. 'Create a hero section...'" />
          <button class="ai-btn" id="send-btn">Generate</button>
        </div>
      </div>

      <div class="editor-container">
        <div id="studio-editor" style="height: 100%"></div>
      </div>
    </div>

    <script>
      let studioEditor = null;

      // 1. Initialize the Editor in the Right Column
      GrapesJsStudioSDK.createStudioEditor({
        root: '#studio-editor',
        licenseKey: 'e50c20f9bbf746e4a85e7bd9ebf0faa601ba3461f1864001a90319272a846cbf',
        theme: 'dark',
        project: { type: 'web' },
        onReady: (editor) => {
          studioEditor = editor;
          console.log('GrapesJS Editor is ready and linked.');
        }
      });

      // 2. Chatbot Logic
      const chatHistory = document.getElementById('chat-history');
      const userInput = document.getElementById('user-input');
      const sendBtn = document.getElementById('send-btn');

      // Helper to add messages
      function addMessage(text, isUser) {
        const div = document.createElement('div');
        div.className = `message ${isUser ? 'user' : 'bot'}`;
        div.innerText = text;
        chatHistory.appendChild(div);
        chatHistory.scrollTop = chatHistory.scrollHeight; // Auto-scroll
      }

      // Handle Send
      sendBtn.onclick = async () => {
        const text = userInput.value;
        if (!text) return;

        // 1. Show User Input
        addMessage(text, true);
        userInput.value = '';

        // 2. Simulate AI Processing (Replace this with your Real AI Call)
        addMessage("Thinking...", false);

        // -- SIMULATED AI RESPONSE --
        // In a real app, you would send 'text' to OpenAI/Claude, get HTML back, and pass it here.
        setTimeout(() => {
          
          if (!studioEditor) {
            addMessage("Error: Editor not ready.", false);
            return;
          }

          // EXAMPLE 1: If user asks for "Hero"
          if (text.toLowerCase().includes('hero')) {
             const heroCode = `
               <section style="background: #222; color: white; padding: 100px 20px; text-align: center;">
                 <h1 style="font-size: 3rem; margin: 0 0 20px 0;">Welcome to the Future</h1>
                 <p style="font-size: 1.2rem; margin-bottom: 30px;">Built with AI and GrapesJS</p>
                 <a href="#" style="background: #6200ea; color: white; padding: 15px 30px; text-decoration: none; border-radius: 5px;">Get Started</a>
               </section>
             `;
             
             // Add to the canvas
             studioEditor.addComponents(heroCode);
             addMessage("I've added a Hero section to your canvas.", false);
          } 
          
          // EXAMPLE 2: If user asks for "Cards"
          else if (text.toLowerCase().includes('card')) {
             const cardsCode = `
               <div style="display: flex; gap: 20px; padding: 50px;">
                 <div style="flex: 1; padding: 20px; border: 1px solid #ddd; background: white; color: #333;"><h3>Feature 1</h3><p>Details here.</p></div>
                 <div style="flex: 1; padding: 20px; border: 1px solid #ddd; background: white; color: #333;"><h3>Feature 2</h3><p>Details here.</p></div>
                 <div style="flex: 1; padding: 20px; border: 1px solid #ddd; background: white; color: #333;"><h3>Feature 3</h3><p>Details here.</p></div>
               </div>
             `;
             studioEditor.addComponents(cardsCode);
             addMessage("I've added a 3-column card layout.", false);
          }

          // Fallback
          else {
             addMessage("I didn't understand that command. Try 'Add a hero section' or 'Add cards'.", false);
          }

        }, 800);
      };

      // Allow "Enter" key to send
      userInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendBtn.click();
      });

    </script>
  </body>
</html>
